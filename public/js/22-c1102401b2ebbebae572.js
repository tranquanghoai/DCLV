(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{133:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=f(a(7)),r=f(a(1)),i=a(6),o=f(a(156)),s=f(a(210)),c=f(a(211)),d=a(158),u=a(298);function f(e){return e&&e.__esModule?e:{default:e}}a(299);var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.getData=a.getData.bind(a),a.changeActive=a.changeActive.bind(a),a.checkLink=a.checkLink.bind(a),a.newsLinkChange=a.newsLinkChange.bind(a),a.save=a.save.bind(a),a.newsLink=r.default.createRef(),a.uploadBox=r.default.createRef(),a.state={item:null,categories:[],editorState:d.EditorState.createEmpty()},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Component),n(t,[{key:"componentDidMount",value:function(){this.getData(),setTimeout(function(){$("#neNewsTitle").focus(),$("#neNewsCategories").select2(),$("#neNewsStartPost").datepicker({format:"dd/mm/yyyy",autoclose:!0,todayHighlight:!0}),$("#neNewsStopPost").datepicker({format:"dd/mm/yyyy",autoclose:!0,todayHighlight:!0})},500)}},{key:"getData",value:function(){var e=this,t="/admin/news/item/"+l.default.routeMatcher("/admin/news/edit/:newsId").parse(window.location.pathname).newsId;l.default.get(t,function(a){if(a.error)l.default.notify("Lấy tin tức bị lỗi!","danger"),e.props.history.push("/admin/news/list"),console.error("GET: "+t+". "+a.error);else if(a.item){$("#neNewsCategories").val(a.item.categories);var n=$("#neNewsStartPost").datepicker({format:"dd/mm/yyyy",autoclose:!0,todayHighlight:!0}),r=$("#neNewsStopPost").datepicker({format:"dd/mm/yyyy",autoclose:!0,todayHighlight:!0});a.item.startPost&&n.datepicker("update",new Date(a.item.startPost)),a.item.stopPost&&r.datepicker("update",new Date(a.item.stopPost)),$(e.newsLink.current).html("http://bktphcm.net/tintuc/"+a.item.link).attr("href","/tintuc/"+a.item.link),e.uploadBox.current.setImage(a.item.image);var i=(0,c.default)(a.item.content),o=i.contentBlocks,s=i.entityMap,u=d.ContentState.createFromBlockArray(o,s),f=d.EditorState.createWithContent(u);e.setState({item:a.item,categories:a.categories,editorState:f})}else e.props.history.push("/admin/news/list")},function(t){l.default.notify("Lấy tin tức bị lỗi!","danger"),e.props.history.push("/admin/news/list")})}},{key:"changeActive",value:function(e){this.setState({item:Object.assign({},this.state.item,{active:e.target.checked})})}},{key:"checkLink",value:function(e){var t="/admin/news/item/check-link";l.default.put(t,{_id:e._id,link:$("#neNewsLink").val().trim()},function(e){e.error?(l.default.notify("Kiểm tra Link bị lỗi!","danger"),console.error("PUT: "+t+". "+error)):l.default.notify("Link hợp lệ!","success")},function(e){return l.default.notify("Kiểm tra Link bị lỗi!","danger")})}},{key:"newsLinkChange",value:function(e){$(this.newsLink.current).html("http://bktphcm.net/tintuc/"+e.target.value).attr("href","/tintuc/"+e.target.value)}},{key:"save",value:function(){var e=this,t=Object.assign({},this.state.item,{categories:$("#neNewsCategories").val(),title:$("#neNewsTitle").val(),link:$("#neNewsLink").val().trim(),startPost:$("#neNewsStartPost").datepicker("getDate"),stopPost:$("#neNewsStopPost").datepicker("getDate"),content:(0,s.default)((0,d.convertToRaw)(this.state.editorState.getCurrentContent()))}),a={categories:t.categories,title:t.title,link:t.link,active:t.active,content:t.content,startPost:t.startPost,stopPost:t.stopPost},n="/admin/news/list";l.default.put(n,{_id:t._id,changes:a},function(a){a.error?(l.default.notify("Tin tức cập nhật bị lỗi","danger"),console.error("PUT: "+n+". "+error)):(l.default.notify("Tin tức được cập nhật!","info"),$("#neNewsLink").val(t.link),e.setState({item:t}))},function(e){return l.default.notify("Tin tức cập nhật bị lỗi","danger")})}},{key:"render",value:function(){var e=this,t=this.state.item?this.state.item:{priority:1,categories:[],title:"",content:"",image:l.default.url("/image/avatar.jpg"),createdDate:new Date,active:!1,view:0},a=""!=t.title?"Tiêu đề: <b>"+t.title+"</b> - "+l.default.dateToText(t.createdDate):"",n="http://bktphcm.net/news/id/"+t._id,s=this.state.categories?this.state.categories.map(function(e,t){return r.default.createElement("option",{key:t,value:e._id},e.title)}):null;return r.default.createElement("main",{className:"app-content"},r.default.createElement("div",{className:"app-title"},r.default.createElement("div",null,r.default.createElement("h1",null,r.default.createElement("i",{className:"fa fa-edit"})," Tin tức: Chỉnh sửa"),r.default.createElement("p",{dangerouslySetInnerHTML:{__html:a}})),r.default.createElement("ul",{className:"app-breadcrumb breadcrumb"},r.default.createElement(i.Link,{to:"/admin"},r.default.createElement("i",{className:"fa fa-home fa-lg"}))," / ",r.default.createElement(i.Link,{to:"/admin/list"},"Danh sách tin tức")," / ",r.default.createElement("a",{href:"#"},"Chỉnh sửa"))),r.default.createElement("br",null),r.default.createElement("div",{className:"row"},r.default.createElement("div",{className:"col-md-6"},r.default.createElement("div",{className:"tile"},r.default.createElement("h3",{className:"tile-title"},"Thông tin chung"),r.default.createElement("div",{className:"tile-body"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Tên bài viết"),r.default.createElement("input",{className:"form-control",type:"text",placeholder:"Tên bài viết",id:"neNewsTitle",defaultValue:t.title})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Hình ảnh"),r.default.createElement(o.default,{postUrl:"/admin/upload",uploadType:"NewsItemImage",ref:this.uploadBox})),r.default.createElement("div",{className:"form-group row"},r.default.createElement("label",{className:"control-label col-3 col-sm-3"},"Kích hoạt"),r.default.createElement("div",{className:"col-8 col-sm-8 toggle"},r.default.createElement("label",null,r.default.createElement("input",{type:"checkbox",checked:t.active,onChange:this.changeActive}),r.default.createElement("span",{className:"button-indecator"})))),r.default.createElement("div",{className:"form-group row"},r.default.createElement("label",{className:"control-label col-3 col-sm-3"},"Lược xem"),r.default.createElement("div",{className:"col-8 col-sm-8"},t.view)),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Danh mục bài viết"),r.default.createElement("select",{className:"form-control",id:"neNewsCategories",multiple:!0,defaultValue:[]},r.default.createElement("optgroup",{label:"Lựa chọn danh mục"},s)))))),r.default.createElement("div",{className:"col-md-6"},r.default.createElement("div",{className:"tile"},r.default.createElement("h3",{className:"tile-title"},"Link"),r.default.createElement("div",{className:"tile-body"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Link mặc định"),r.default.createElement("br",null),r.default.createElement("a",{href:n,style:{fontWeight:"bold"},target:"_blank"},n)),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Link truyền thông"),r.default.createElement("br",null),r.default.createElement("a",{href:"#",ref:this.newsLink,style:{fontWeight:"bold"},target:"_blank"}),r.default.createElement("input",{className:"form-control",id:"neNewsLink",type:"text",placeholder:"Link truyền thông",defaultValue:t.link,onChange:this.newsLinkChange}))),r.default.createElement("div",{className:"tile-footer"},r.default.createElement("button",{className:"btn btn-danger",type:"button",onClick:function(){return e.checkLink(t)}},r.default.createElement("i",{className:"fa fa-fw fa-lg fa-check-circle"}),"Kiểm tra link"))),r.default.createElement("div",{className:"tile"},r.default.createElement("h3",{className:"tile-title"},"Ngày tháng"),r.default.createElement("div",{className:"tile-body"},r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Ngày tạo: ",l.default.dateToText(t.createdDate))),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Ngày bắt đầu đăng bài viết"),r.default.createElement("input",{className:"form-control",id:"neNewsStartPost",type:"text",placeholder:"Ngày bắt đầu đăng bài viết",defaultValue:t.startPost})),r.default.createElement("div",{className:"form-group"},r.default.createElement("label",{className:"control-label"},"Ngày kết thúc đăng bài viết"),r.default.createElement("input",{className:"form-control",id:"neNewsStopPost",type:"text",placeholder:"Ngày kết thúc đăng bài viết",defaultValue:t.stopPost}))))),r.default.createElement("div",{className:"col-md-12"},r.default.createElement("div",{className:"tile"},r.default.createElement("h3",{className:"tile-title"},"Nội dung bài viết"),r.default.createElement("div",{className:"tile-body"},r.default.createElement(u.Editor,{editorState:this.state.editorState,editorStyle:{border:"solid 1px #eee",minHeight:"100px",padding:"0 3px"},toolbar:{},onEditorStateChange:function(t){return e.setState({editorState:t})}}))))),r.default.createElement(i.Link,{to:"/admin/news/list",className:"btn btn-secondary btn-circle",style:{position:"fixed",lefft:"10px",bottom:"10px"}},r.default.createElement("i",{className:"fa fa-lg fa-reply"})),r.default.createElement("button",{type:"button",className:"btn btn-primary btn-circle",style:{position:"fixed",right:"10px",bottom:"10px"},onClick:this.save},r.default.createElement("i",{className:"fa fa-lg fa-save"})))}}]),t}();t.default=p},156:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=i(a(7));a(157);var r=i(a(1));function i(e){return e&&e.__esModule?e:{default:e}}var o={backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"auto",height:"124px",color:"black",border:"1px dashed #333"},s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.setImage=a.setImage.bind(a),a.box=r.default.createRef(),a.progress=r.default.createRef(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Component),n(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){var t=$(e.box.current),a=$(e.progress.current);t.mfupload({type:e.props.fileType?e.props.fileType:"png, jpg, jpeg, bmp",maxsize:e.props.maxSize?e.props.maxSize:5,post_upload:e.props.postUrl,folder:"./",ini_text:e.props.innerText?e.props.innerText:"",over_text:e.props.overText?e.props.overText:"Thả hình ảnh xuống ô này!",over_col:e.props.overColor?e.props.overColor:"#fff",over_bkcol:e.props.overBackColor?e.props.overBackColor:"#0e7dc2",init:function(){},loaded:function(e){t.css("display","none"),e.error||e.image&&t.css("background-image","url("+l.default.url(e.image)+")")},progress:function(e){return a.text("Upload "+e.perc+"%")},error:function(e){t.css("display","block"),l.default.notify("Tải hình bị lỗi: "+e,"danger"),console.log("UploadBox",e)},completed:function(){t.css("display","block"),a.text("")}})},500)}},{key:"setImage",value:function(e){$(this.box.current).css("background-image","url("+l.default.url(e)+")")}},{key:"render",value:function(){return[r.default.createElement("div",{ref:this.box,id:this.props.uploadType,style:o,key:0}),r.default.createElement("small",{className:"form-text text-primary",style:{textAlign:"center"},key:1},this.props.description?this.props.description:"Nhấp hoặc kéo hình ảnh thả vào ô phía trên!"),r.default.createElement("small",{ref:this.progress,className:"form-text text-muted",style:{textAlign:"center"},key:2})]}}]),t}();t.default=s,s.propTypes={fileType:l.default.PropTypes.string,maxSize:l.default.PropTypes.number,uploadType:l.default.PropTypes.string.isRequired,innerText:l.default.PropTypes.string,overText:l.default.PropTypes.string,overColor:l.default.PropTypes.string,overBackColor:l.default.PropTypes.string,description:l.default.PropTypes.string,postUrl:l.default.PropTypes.string.isRequired}},157:function(e,t,a){"use strict";!function(e){var t,a={completed:function(){},start:function(){},loaded:function(){},progress:function(){},error:function(){},upload_old:function(a,n){t.init();var l={fileno:-1,filename:a.attr("value").replace(/^.*[\\\/]/,""),perc:0,sent:0,total:0};t.start(l),e('<iframe id="'+n+'" name="'+n+'" src="#" style="display:none"></iframe>').appendTo("body"),e("#"+n).bind("load",function(){var a=e("#"+n).contents().find("body").html(),l=jQuery.parseJSON(a);l.fileno=-1,t.loaded(l),t.completed(),e("#"+n).unbind("load"),e("#"+n).remove()}),a.parent().submit()},upload:function(e){var a=e.length,n=a;if(t.init(),void 0!==e)for(var l=0;l<a;l++){var r=e[l].name.toLowerCase().split(/\./);if(r=r[r.length-1],t.type&&-1==t.type.indexOf(r)){var i={err_no:1,err_des:"File type error",fileno:l,filename:e[l].name};t.error(i),0==--n&&t.completed()}else if(t.maxsize>0&&e[l].size>1048576*t.maxsize){i={err_no:2,err_des:"File size error",fileno:l,filename:e[l].name};t.error(i),0==--n&&t.completed()}else{var o={fileno:l,filename:e[l].name,perc:0,sent:0,total:0};t.start(o);try{var s=new XMLHttpRequest}catch(e){return alert("Your browser does not support AJAX!"),!1}s.open("POST",t.post_upload,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.upload.filenumb=l,s.filenumb=l,s.upload.filename=e[l].name,s.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=Math.ceil(e.loaded/e.total*100),n={fileno:this.filenumb,filename:this.filename,perc:a,sent:e.loaded,total:e.total};t.progress(n)}},!1),s.addEventListener("load",function(e){var a=jQuery.parseJSON(e.target.responseText);a.fileno=this.filenumb,t.loaded(a),0==--n&&t.completed()},!1);var c=new FormData;c.append("folder",t.folder),c.append("file_element",t.file_elem),c.append("udata",t.user_data),c.append(t.file_elem,e[l]),s.send(c)}}else alert("no support")}};e.fn.mfupload=function(n){t={init:a.init,start:a.start,loaded:a.loaded,progress:a.progress,completed:a.completed,ini_text:"Drag image to here",over_text:"Drop image",over_col:"white",over_bkcol:"green",post_upload:"cover/upload",maxsize:5,type:"",folder:"./",user_data:"",file_elem:""},n&&e.extend(t,n),this.each(function(){window.location==window.parent.location&&(t.file_elem="mf_file_"+e(this).attr("id"),t.iframe="mf_iframe_"+e(this).attr("id"),e(this).append('<div class="mf_upload_m"><form method="post" enctype="multipart/form-data" class="file" action="'+t.post_upload+'" target="'+t.iframe+'"><input type="file" class="file" name="'+t.file_elem+'" id="'+t.file_elem+'" multiple /><input type="hidden" name="folder" value="'+t.folder+'" /><input type="hidden" name="file_element" value="'+t.file_elem+'" /></form><div class="mf_upload_ins"></div></div>'),e(this).find(".mf_upload_m").css({position:"relative",margin:0,padding:0,width:"inherit",height:"inherit"}),e(this).find(".file").css({position:"relative","text-align":"right","-moz-opacity":"0",filter:"alpha(opacity: 0)",opacity:"0","z-index":"2",width:"100%",height:"100%",top:0,left:0}),e(this).find(".mf_upload_ins").css({position:"absolute","text-align":"center","z-index":"1",width:"100%",height:"100%",top:0,left:0}),e(this).find(".mf_upload_ins").empty().html(t.ini_text),e(this).bind({dragleave:function(a){a.preventDefault(),e(this).find(".mf_upload_ins").css("color","inherit"),e(this).find(".mf_upload_ins").css("background-color","inherit").html(t.ini_text)},drop:function(n){n.preventDefault(),e(this).find(".mf_upload_ins").css("color","inherit"),e(this).find(".mf_upload_ins").css("background-color","inherit").html(t.ini_text);var l=n.originalEvent;l.dataTransfer.files?a.upload(l.dataTransfer.files):alert("Drag and Drop not supported by your browser.")},dragover:function(a){a.preventDefault(),e(this).find(".mf_upload_ins").css("color",t.over_col),e(this).find(".mf_upload_ins").css("background-color",t.over_bkcol),e(this).find(".mf_upload_ins").html(t.over_text)}}),e(this).find("input[type=file]").bind("change",function(n){n.preventDefault(),n.target.files?a.upload(n.target.files):a.upload_old(e(this),t.iframe)}))})}}(jQuery)}}]);